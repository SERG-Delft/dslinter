<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>In-Place APIs Misused | DSLinter - Linter for Machine Learning - Specific Code Smells</title><meta name=keywords content="generic,data cleaning,error-prone"><meta name=description content="Remember to assign the result of an operation to a variable or set the in-place parameter in the API."><meta name=author content><link rel=canonical href=https://hynn01.github.io/dslinter/posts/codesmells/1-in-place-apis-misused/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/dslinter/assets/css/stylesheet.min.118d582b9317eeb0017c428ab7f64c4be58e68881aeb263d9b75c61866e244de.css integrity="sha256-EY1YK5MX7rABfEKKt/ZMS+WOaIga6yY9m3XGGGbiRN4=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/dslinter/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.96.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="In-Place APIs Misused"><meta property="og:description" content="Remember to assign the result of an operation to a variable or set the in-place parameter in the API."><meta property="og:type" content="article"><meta property="og:url" content="https://hynn01.github.io/dslinter/posts/codesmells/1-in-place-apis-misused/"><meta property="article:section" content="posts"><meta property="og:site_name" content="DSLinter - Linter for Machine Learning Application - Specific Code Smells"><meta name=twitter:card content="summary"><meta name=twitter:title content="In-Place APIs Misused"><meta name=twitter:description content="Remember to assign the result of an operation to a variable or set the in-place parameter in the API."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://hynn01.github.io/dslinter/posts/"},{"@type":"ListItem","position":2,"name":"Code Smells","item":"https://hynn01.github.io/dslinter/posts/codesmells/"},{"@type":"ListItem","position":3,"name":"In-Place APIs Misused","item":"https://hynn01.github.io/dslinter/posts/codesmells/1-in-place-apis-misused/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"In-Place APIs Misused","name":"In-Place APIs Misused","description":"Remember to assign the result of an operation to a variable or set the in-place parameter in the API.","keywords":["generic","data cleaning","error-prone"],"articleBody":"Description Context Data structures can be manipulated in mainly two different approaches: 1) by applying the changes to a copy of the data structure and leaving the original object intact, or 2) by changing the existing data structure (also known as in-place).\nProblem Some methods can adopt in-place by default, while others return a copy. If the developer assumes an in-place approach, he will not assign the returned value to any variable. Hence, the operation will be executed, but it will not affect the final outcome. For example, when using the Pandas library, the developer may not assign the result of df.dropna() to a variable. He may assume that this API will make changes on the original DataFrame and not set the in-place parameter to be True either. The original DataFrame will not be updated in this way. In the \"TensorFlow Bugs\" replication package, we also found an example where the developer thought np.clip() is an in-place operation and used it without assigning it to a new variable.\nSolution We suggest developers check whether the result of the operation is assigned to a variable or the in-place parameter is set in the API. Some developers hold the view that the in-place operation will save memory. However, this is a misconception in the Pandas library because the copy of the data is still created. In PyTorch, the in-place operation does save GPU memory, but it risks overwriting the values needed to compute the gradient.\nType Generic\nExisting Stage Data Cleaning\nEffect Error-prone\nExample ### NumPy import numpy as np zhats = [2, 3, 1, 0] - np.clip(zhats, -1, 1) + zhats = np.clip(zhats, -1, 1)  ### Pandas import pandas as pd df = pd.DataFrame([-1]) - df.abs() + df = df.abs() Source: Paper  MPA Haakman. 2020. Studying the Machine Learning Lifecycle and ImprovingCode Quality of Machine Learning Applications.  Grey Literature  https://towardsdatascience.com/in-place-operations-in-pytorch-f91d493e970e https://github.com/bamos/dcgan-completion.tensorflow/commit/e8b930501dffe01db423b6ca1c65d3ac54f27223  GitHub Commit Stack Overflow Documentation ","wordCount":"315","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://hynn01.github.io/dslinter/posts/codesmells/1-in-place-apis-misused/"},"publisher":{"@type":"Organization","name":"DSLinter - Linter for Machine Learning - Specific Code Smells","logo":{"@type":"ImageObject","url":"https://hynn01.github.io/dslinter/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://hynn01.github.io/dslinter/ accesskey=h title="DSLinter - Linter for Machine Learning - Specific Code Smells (Alt + H)">DSLinter - Linter for Machine Learning - Specific Code Smells</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://hynn01.github.io/dslinter/posts/codesmells/ title="Code Smells"><span>Code Smells</span></a></li><li><a href=https://hynn01.github.io/dslinter/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://hynn01.github.io/dslinter/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://hynn01.github.io/dslinter/>Home</a>&nbsp;»&nbsp;<a href=https://hynn01.github.io/dslinter/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://hynn01.github.io/dslinter/posts/codesmells/>Code Smells</a></div><h1 class=post-title>In-Place APIs Misused</h1><div class=post-meta></div></header><div class=post-content><h3 id=description>Description<a hidden class=anchor aria-hidden=true href=#description>#</a></h3><h4 id=context>Context<a hidden class=anchor aria-hidden=true href=#context>#</a></h4><p>Data structures can be manipulated in mainly two different approaches: 1) by applying the changes to a copy of the data structure and leaving the original object intact, or 2) by changing the existing data structure (also known as in-place).</p><h4 id=problem>Problem<a hidden class=anchor aria-hidden=true href=#problem>#</a></h4><p>Some methods can adopt in-place by default, while others return a copy. If the developer assumes an in-place approach, he will not assign the returned value to any variable. Hence, the operation will be executed, but it will not affect the final outcome. For example, when using the Pandas library, the developer may not assign the result of <code>df.dropna()</code> to a variable. He may assume that this API will make changes on the original <code>DataFrame</code> and not set the in-place parameter to be <code>True</code> either. The original <code>DataFrame</code> will not be updated in this way. In the <code>"TensorFlow Bugs" replication package</code>, we also found an example where the developer thought <code>np.clip()</code> is an in-place operation and used it without assigning it to a new variable.</p><h4 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h4><p>We suggest developers check whether the result of the operation is assigned to a variable or the in-place parameter is set in the API. Some developers hold the view that the in-place operation will save memory. However, this is a misconception in the Pandas library because the copy of the data is still created. In PyTorch, the in-place operation does save GPU memory, but it risks overwriting the values needed to compute the gradient.</p><h3 id=type>Type<a hidden class=anchor aria-hidden=true href=#type>#</a></h3><p>Generic</p><h3 id=existing-stage>Existing Stage<a hidden class=anchor aria-hidden=true href=#existing-stage>#</a></h3><p>Data Cleaning</p><h3 id=effect>Effect<a hidden class=anchor aria-hidden=true href=#effect>#</a></h3><p>Error-prone</p><h3 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span>### NumPy
</span></span><span style=display:flex><span>import numpy as np
</span></span><span style=display:flex><span>zhats = [2, 3, 1, 0]
</span></span><span style=display:flex><span><span style=color:#f92672>- np.clip(zhats, -1, 1)
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+ zhats = np.clip(zhats, -1, 1)
</span></span></span><span style=display:flex><span><span style=color:#a6e22e></span>
</span></span><span style=display:flex><span>### Pandas
</span></span><span style=display:flex><span>import pandas as pd
</span></span><span style=display:flex><span>df = pd.DataFrame([-1])
</span></span><span style=display:flex><span><span style=color:#f92672>- df.abs()
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+ df = df.abs()
</span></span></span></code></pre></div><h3 id=source>Source:<a hidden class=anchor aria-hidden=true href=#source>#</a></h3><h4 id=paper>Paper<a hidden class=anchor aria-hidden=true href=#paper>#</a></h4><ul><li>MPA Haakman. 2020. Studying the Machine Learning Lifecycle and ImprovingCode Quality of Machine Learning Applications.</li></ul><h4 id=grey-literature>Grey Literature<a hidden class=anchor aria-hidden=true href=#grey-literature>#</a></h4><ul><li><a href=https://towardsdatascience.com/in-place-operations-in-pytorch-f91d493e970e>https://towardsdatascience.com/in-place-operations-in-pytorch-f91d493e970e</a></li><li><a href=https://github.com/bamos/dcgan-completion.tensorflow/commit/e8b930501dffe01db423b6ca1c65d3ac54f27223>https://github.com/bamos/dcgan-completion.tensorflow/commit/e8b930501dffe01db423b6ca1c65d3ac54f27223</a></li></ul><h4 id=github-commit>GitHub Commit<a hidden class=anchor aria-hidden=true href=#github-commit>#</a></h4><h4 id=stack-overflow>Stack Overflow<a hidden class=anchor aria-hidden=true href=#stack-overflow>#</a></h4><h4 id=documentation>Documentation<a hidden class=anchor aria-hidden=true href=#documentation>#</a></h4></div><footer class=post-footer><ul class=post-tags><li><a href=https://hynn01.github.io/dslinter/tags/generic/>generic</a></li><li><a href=https://hynn01.github.io/dslinter/tags/data-cleaning/>data cleaning</a></li><li><a href=https://hynn01.github.io/dslinter/tags/error-prone/>error-prone</a></li></ul><nav class=paginav><a class=next href=https://hynn01.github.io/dslinter/posts/codesmells/2-unnecessary-iteration/><span class=title>Next Page »</span><br><span>Unnecessary Iteration</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://hynn01.github.io/dslinter/>DSLinter - Linter for Machine Learning - Specific Code Smells</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>